---
title: å¤©æ± _äºŒæ‰‹è½¦ä»·æ ¼é¢„æµ‹_Task_3_ç‰¹å¾å·¥ç¨‹
date: 2020-04-02 14:56:56
tags:
    - Editor
    - DataMining
    - Tianchi
    - Study
    - Jupyter
    - seaborn
    - pandas
    - Onehot
    - BoxPlot
    - IQR
    - groupby
    - è¿‡æ»¤å¼(filter)
    - åŒ…è£¹å¼(wrapper)
    - åµŒå…¥å¼ï¼ˆembeddingï¼‰
categories: Algorithm
mathjax: true
image: "https://blog-1259799643.cos.ap-shanghai.myqcloud.com/osman-rana-G7VN8NadjO0-unsplash.jpg"
---

æ¥ç»­
<!-- more -->
# ç‰¹å¾å·¥ç¨‹ğŸƒ

&emsp;&emsp;ç‰¹å¾å·¥ç¨‹ï¼Œæ˜¯æŒ‡ç”¨ä¸€ç³»åˆ—å·¥ç¨‹åŒ–çš„æ–¹å¼ä»åŸå§‹æ•°æ®ä¸­ç­›é€‰å‡ºæ›´å¥½çš„æ•°æ®ç‰¹å¾ï¼Œä»¥æå‡æ¨¡å‹çš„è®­ç»ƒæ•ˆæœã€‚ä¸šå†…æœ‰ä¸€å¥å¹¿ä¸ºæµä¼ çš„è¯æ˜¯ï¼šæ•°æ®å’Œç‰¹å¾å†³å®šäº†æœºå™¨å­¦ä¹ çš„ä¸Šé™ï¼Œè€Œæ¨¡å‹å’Œç®—æ³•æ˜¯åœ¨é€¼è¿‘è¿™ä¸ªä¸Šé™è€Œå·²ã€‚ç”±æ­¤å¯è§ï¼Œå¥½çš„æ•°æ®å’Œç‰¹å¾æ˜¯æ¨¡å‹å’Œç®—æ³•å‘æŒ¥æ›´å¤§çš„ä½œç”¨çš„å‰æã€‚ç‰¹å¾å·¥ç¨‹é€šå¸¸åŒ…æ‹¬æ•°æ®é¢„å¤„ç†ã€ç‰¹å¾é€‰æ‹©ã€é™ç»´ç­‰ç¯èŠ‚ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200402004507865.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0V4Y2FsaWJ1clVsaW1pdGVk,size_16,color_FFFFFF,t_70#pic_center)
## 0ï¸âƒ£ å‰è¨€

&emsp;&emsp;æˆ‘ä»¬ç»å¸¸åœ¨å¤„ç†æ•°æ®æ—¶ï¼Œä¼šé¢ä¸´ä»¥ä¸‹é—®é¢˜ï¼š
- æ”¶é›†çš„æ•°æ®æ ¼å¼ä¸å¯¹ï¼ˆå¦‚ `SQL` æ•°æ®åº“ã€`JSON`ã€`CSV` ç­‰ï¼‰
- ç¼ºå¤±å€¼å’Œå¼‚å¸¸å€¼
- æ ‡å‡†åŒ–
- å‡å°‘æ•°æ®é›†ä¸­å­˜åœ¨çš„å›ºæœ‰å™ªå£°ï¼ˆéƒ¨åˆ†å­˜å‚¨æ•°æ®å¯èƒ½å·²æŸåï¼‰
- æ•°æ®é›†ä¸­çš„æŸäº›åŠŸèƒ½å¯èƒ½æ— æ³•æ”¶é›†ä»»ä½•ä¿¡æ¯ä»¥ä¾›åˆ†æ

è€Œå‡å°‘ç»Ÿè®¡åˆ†ææœŸé—´è¦ä½¿ç”¨çš„ç‰¹å¾çš„æ•°é‡å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›å¥½å¤„ï¼Œä¾‹å¦‚ï¼š
- æé«˜ç²¾åº¦
- é™ä½è¿‡æ‹Ÿåˆé£é™©
- åŠ å¿«è®­ç»ƒé€Ÿåº¦
- æ”¹è¿›æ•°æ®å¯è§†åŒ–
- å¢åŠ æˆ‘ä»¬æ¨¡å‹çš„å¯è§£é‡Šæ€§

äº‹å®ä¸Šï¼Œç»Ÿè®¡ä¸Šè¯æ˜ï¼Œå½“æ‰§è¡Œæœºå™¨å­¦ä¹ ä»»åŠ¡æ—¶ï¼Œå­˜åœ¨é’ˆå¯¹æ¯ä¸ªç‰¹å®šä»»åŠ¡åº”è¯¥ä½¿ç”¨çš„**æœ€ä½³æ•°é‡çš„ç‰¹å¾**ï¼ˆå›¾ 1ï¼‰ã€‚å¦‚æœæ·»åŠ çš„ç‰¹å¾æ¯”å¿…è¦çš„ç‰¹å¾**å¤š**ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„æ¨¡å‹æ€§èƒ½å°†**ä¸‹é™**ï¼ˆå› ä¸ºæ·»åŠ äº†å™ªå£°ï¼‰ã€‚çœŸæ­£çš„æŒ‘æˆ˜æ˜¯æ‰¾å‡ºå“ªäº›ç‰¹å¾æ˜¯**æœ€ä½³çš„ä½¿ç”¨ç‰¹å¾**ï¼ˆè¿™å®é™…ä¸Šå–å†³äºæˆ‘ä»¬æä¾›çš„æ•°æ®é‡å’Œæˆ‘ä»¬æ­£åœ¨åŠªåŠ›å®ç°çš„ä»»åŠ¡çš„å¤æ‚æ€§ï¼‰ã€‚è¿™å°±æ˜¯ç‰¹å¾é€‰æ‹©æŠ€æœ¯èƒ½å¤Ÿå¸®åˆ°æˆ‘ä»¬çš„åœ°æ–¹ï¼

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200402005242590.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0V4Y2FsaWJ1clVsaW1pdGVk,size_16,color_FFFFFF,t_70#pic_center)

### 0ï¸âƒ£.1ï¸âƒ£ èµ›é¢˜é‡è¿°
    
&emsp;&emsp;è¿™æ˜¯ä¸€é“æ¥è‡ªäºå¤©æ± çš„æ–°æ‰‹ç»ƒä¹ é¢˜ç›®ï¼Œç”¨`æ•°æ®åˆ†æ`ã€`æœºå™¨å­¦ä¹ `ç­‰æ‰‹æ®µè¿›è¡Œ [äºŒæ‰‹è½¦å”®å–ä»·æ ¼é¢„æµ‹](https://tianchi.aliyun.com/competition/entrance/231784/information) çš„å›å½’é—®é¢˜ã€‚èµ›é¢˜æœ¬èº«çš„æ€è·¯æ¸…æ™°æ˜äº†ï¼Œå³å¯¹ç»™å®šçš„æ•°æ®é›†è¿›è¡Œåˆ†ææ¢è®¨ï¼Œç„¶åè®¾è®¡æ¨¡å‹è¿ç”¨æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œæµ‹è¯•æ¨¡å‹ï¼Œæœ€ç»ˆç»™å‡ºé€‰æ‰‹çš„é¢„æµ‹ç»“æœã€‚å‰é¢æˆ‘ä»¬å·²ç»è¿›è¡Œè¿‡EDAåˆ†æåœ¨è¿™é‡Œ[å¤©æ± _äºŒæ‰‹è½¦ä»·æ ¼é¢„æµ‹_Task1-2_èµ›é¢˜ç†è§£ä¸æ•°æ®åˆ†æ
](https://blog.csdn.net/ExcaliburUlimited/article/details/105021630)

### 0ï¸âƒ£.2ï¸âƒ£ æ•°æ®é›†æ¦‚è¿°
&emsp;&emsp;èµ›é¢˜å®˜æ–¹ç»™å‡ºäº†æ¥è‡ªEbay Kleinanzeigençš„äºŒæ‰‹è½¦äº¤æ˜“è®°å½•ï¼Œæ€»æ•°æ®é‡è¶…è¿‡**40w**ï¼ŒåŒ…å«**31åˆ—**å˜é‡ä¿¡æ¯ï¼Œå…¶ä¸­**15åˆ—**ä¸ºåŒ¿åå˜é‡ï¼Œå³`v0`è‡³`v15`ã€‚å¹¶ä»ä¸­æŠ½å–**15ä¸‡æ¡**ä½œä¸ºè®­ç»ƒé›†ï¼Œ**5ä¸‡**æ¡ä½œä¸ºæµ‹è¯•é›†Aï¼Œ**5ä¸‡**æ¡ä½œä¸ºæµ‹è¯•é›†Bï¼ŒåŒæ—¶å¯¹`name`ã€`model`ã€`brand`å’Œ`regionCode`ç­‰ä¿¡æ¯è¿›è¡Œè„±æ•ã€‚å…·ä½“çš„æ•°æ®è¡¨å¦‚ä¸‹å›¾ï¼š

<div class="table-wrapper" style = "center"><table style = "center">
<thead>
<tr style = "center">
<th><strong>Field</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody style = "center">
<tr style = "center">
<td >SaleID</td>
<td>äº¤æ˜“IDï¼Œå”¯ä¸€ç¼–ç </td>
</tr>
<tr>
<td>name</td>
<td>æ±½è½¦äº¤æ˜“åç§°ï¼Œå·²è„±æ•</td>
</tr>
<tr>
<td>regDate</td>
<td>æ±½è½¦æ³¨å†Œæ—¥æœŸï¼Œä¾‹å¦‚20160101ï¼Œ2016å¹´01æœˆ01æ—¥</td>
</tr>
<tr>
<td>model</td>
<td>è½¦å‹ç¼–ç ï¼Œå·²è„±æ•</td>
</tr>
<tr>
<td>brand</td>
<td>æ±½è½¦å“ç‰Œï¼Œå·²è„±æ•</td>
</tr>
<tr>
<td>bodyType</td>
<td>è½¦èº«ç±»å‹ï¼šè±ªåè½¿è½¦ï¼š0ï¼Œå¾®å‹è½¦ï¼š1ï¼Œå¢å‹è½¦ï¼š2ï¼Œå¤§å·´è½¦ï¼š3ï¼Œæ•ç¯·è½¦ï¼š4ï¼ŒåŒé—¨æ±½è½¦ï¼š5ï¼Œå•†åŠ¡è½¦ï¼š6ï¼Œæ…æ‹Œè½¦ï¼š7</td>
</tr>
<tr>
<td>fuelType</td>
<td>ç‡ƒæ²¹ç±»å‹ï¼šæ±½æ²¹ï¼š0ï¼ŒæŸ´æ²¹ï¼š1ï¼Œæ¶²åŒ–çŸ³æ²¹æ°”ï¼š2ï¼Œå¤©ç„¶æ°”ï¼š3ï¼Œæ··åˆåŠ¨åŠ›ï¼š4ï¼Œå…¶ä»–ï¼š5ï¼Œç”µåŠ¨ï¼š6</td>
</tr>
<tr>
<td>gearbox</td>
<td>å˜é€Ÿç®±ï¼šæ‰‹åŠ¨ï¼š0ï¼Œè‡ªåŠ¨ï¼š1</td>
</tr>
<tr>
<td>power</td>
<td>å‘åŠ¨æœºåŠŸç‡ï¼šèŒƒå›´ [ 0,  600 ]</td>
</tr>
<tr>
<td>kilometer</td>
<td>æ±½è½¦å·²è¡Œé©¶å…¬é‡Œï¼Œå•ä½ä¸‡km</td>
</tr>
<tr>
<td>notRepairedDamage</td>
<td>æ±½è½¦æœ‰å°šæœªä¿®å¤çš„æŸåï¼šæ˜¯ï¼š0ï¼Œå¦ï¼š1</td>
</tr>
<tr>
<td>regionCode</td>
<td>åœ°åŒºç¼–ç ï¼Œå·²è„±æ•</td>
</tr>
<tr>
<td>seller</td>
<td>é”€å”®æ–¹ï¼šä¸ªä½“ï¼š0ï¼Œéä¸ªä½“ï¼š1</td>
</tr>
<tr>
<td>offerType</td>
<td>æŠ¥ä»·ç±»å‹ï¼šæä¾›ï¼š0ï¼Œè¯·æ±‚ï¼š1</td>
</tr>
<tr>
<td>creatDate</td>
<td>æ±½è½¦ä¸Šçº¿æ—¶é—´ï¼Œå³å¼€å§‹å”®å–æ—¶é—´</td>
</tr>
<tr>
<td>price</td>
<td>äºŒæ‰‹è½¦äº¤æ˜“ä»·æ ¼ï¼ˆé¢„æµ‹ç›®æ ‡ï¼‰</td>
</tr>
<tr>
<td>vç³»åˆ—ç‰¹å¾</td>
<td>åŒ¿åç‰¹å¾ï¼ŒåŒ…å«v0-14åœ¨å†…15ä¸ªåŒ¿åç‰¹å¾</td>
</tr>
</tbody>
</table>
</div>

## 1ï¸âƒ£ å¼‚å¸¸ç¼ºå¤±å€¼åˆ é™¤
### 1ï¸âƒ£.1ï¸âƒ£  å¯¼å…¥åº“ä¸æ•°æ®


```python
import pandas as pd
import numpy as np
import matplotlib
import matplotlib.pyplot as plt
import seaborn as sns
from operator import itemgetter

%matplotlib inline
```


```python
train = pd.read_csv('used_car_train_20200313.csv', sep=' ')
test = pd.read_csv('used_car_testA_20200313.csv', sep=' ')
print(train.shape)
print(test.shape)
```

    (150000, 31)
    (50000, 30)
    


```python
train.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SaleID</th>
      <th>name</th>
      <th>regDate</th>
      <th>model</th>
      <th>brand</th>
      <th>bodyType</th>
      <th>fuelType</th>
      <th>gearbox</th>
      <th>power</th>
      <th>kilometer</th>
      <th>...</th>
      <th>v_5</th>
      <th>v_6</th>
      <th>v_7</th>
      <th>v_8</th>
      <th>v_9</th>
      <th>v_10</th>
      <th>v_11</th>
      <th>v_12</th>
      <th>v_13</th>
      <th>v_14</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>736</td>
      <td>20040402</td>
      <td>30.0</td>
      <td>6</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>60</td>
      <td>12.5</td>
      <td>...</td>
      <td>0.235676</td>
      <td>0.101988</td>
      <td>0.129549</td>
      <td>0.022816</td>
      <td>0.097462</td>
      <td>-2.881803</td>
      <td>2.804097</td>
      <td>-2.420821</td>
      <td>0.795292</td>
      <td>0.914762</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>2262</td>
      <td>20030301</td>
      <td>40.0</td>
      <td>1</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0</td>
      <td>15.0</td>
      <td>...</td>
      <td>0.264777</td>
      <td>0.121004</td>
      <td>0.135731</td>
      <td>0.026597</td>
      <td>0.020582</td>
      <td>-4.900482</td>
      <td>2.096338</td>
      <td>-1.030483</td>
      <td>-1.722674</td>
      <td>0.245522</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2</td>
      <td>14874</td>
      <td>20040403</td>
      <td>115.0</td>
      <td>15</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>163</td>
      <td>12.5</td>
      <td>...</td>
      <td>0.251410</td>
      <td>0.114912</td>
      <td>0.165147</td>
      <td>0.062173</td>
      <td>0.027075</td>
      <td>-4.846749</td>
      <td>1.803559</td>
      <td>1.565330</td>
      <td>-0.832687</td>
      <td>-0.229963</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3</td>
      <td>71865</td>
      <td>19960908</td>
      <td>109.0</td>
      <td>10</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>193</td>
      <td>15.0</td>
      <td>...</td>
      <td>0.274293</td>
      <td>0.110300</td>
      <td>0.121964</td>
      <td>0.033395</td>
      <td>0.000000</td>
      <td>-4.509599</td>
      <td>1.285940</td>
      <td>-0.501868</td>
      <td>-2.438353</td>
      <td>-0.478699</td>
    </tr>
    <tr>
      <td>4</td>
      <td>4</td>
      <td>111080</td>
      <td>20120103</td>
      <td>110.0</td>
      <td>5</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>68</td>
      <td>5.0</td>
      <td>...</td>
      <td>0.228036</td>
      <td>0.073205</td>
      <td>0.091880</td>
      <td>0.078819</td>
      <td>0.121534</td>
      <td>-1.896240</td>
      <td>0.910783</td>
      <td>0.931110</td>
      <td>2.834518</td>
      <td>1.923482</td>
    </tr>
  </tbody>
</table>
<p>5 rows Ã— 31 columns</p>
</div>




```python
train.columns
```




    Index(['SaleID', 'name', 'regDate', 'model', 'brand', 'bodyType', 'fuelType',
           'gearbox', 'power', 'kilometer', 'notRepairedDamage', 'regionCode',
           'seller', 'offerType', 'creatDate', 'price', 'v_0', 'v_1', 'v_2', 'v_3',
           'v_4', 'v_5', 'v_6', 'v_7', 'v_8', 'v_9', 'v_10', 'v_11', 'v_12',
           'v_13', 'v_14'],
          dtype='object')



### 1ï¸âƒ£.2ï¸âƒ£  å¼‚å¸¸å€¼åˆ é™¤
&emsp;&emsp;è¿™é‡Œå¯ä»¥å°†ç®±å‹å›¾ä¸­çš„è¶…è¿‡ä¸Šä¸‹é™çš„é‚£äº›å€¼ä½œä¸ºå¼‚å¸¸å€¼åˆ é™¤ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç®±å‹å›¾ä¸­é—´æ˜¯ä¸€ä¸ªç®±ä½“ï¼Œä¹Ÿå°±æ˜¯ç²‰çº¢è‰²éƒ¨åˆ†ï¼Œç®±ä½“å·¦è¾¹ï¼Œä¸­é—´ï¼Œå³è¾¹åˆ†åˆ«æœ‰ä¸€æ¡çº¿ï¼Œå·¦è¾¹æ˜¯ä¸‹åˆ†ä½æ•°($Q1$)ï¼Œå³è¾¹æ˜¯ä¸Šå››åˆ†ä½æ•°($Q3$)ï¼Œä¸­é—´æ˜¯ä¸­ä½æ•°($Median$)ï¼Œä¸Šä¸‹å››åˆ†ä½æ•°ä¹‹å·®æ˜¯å››åˆ†ä½è·$IQRï¼ˆInterquartile Range$ï¼Œç”¨$Q1-1.5*IQR$å¾—åˆ°ä¸‹è¾¹ç¼˜ï¼ˆæœ€å°å€¼ï¼‰ï¼Œ$Q3+1.5*IQR$å¾—åˆ°ä¸Šè¾¹ç¼˜ï¼ˆæœ€å¤§å€¼ï¼‰ã€‚åœ¨ä¸Šè¾¹ç¼˜ä¹‹å¤–çš„æ•°æ®å°±æ˜¯æå¤§å¼‚å¸¸å€¼ï¼Œåœ¨ä¸‹è¾¹ç¼˜ä¹‹å¤–çš„æ•°æ®å°±æ˜¯æå°å¼‚å¸¸å€¼ã€‚
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200402004441943.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0V4Y2FsaWJ1clVsaW1pdGVk,size_16,color_FFFFFF,t_70#pic_center)

ææ¸…æ¥šåŸç†é‚£æˆ‘ä»¬å°±æ„é€ ä¸€ä¸ªå®ç°ä¸Šè¿°åŠŸèƒ½çš„å‡½æ•°å§ï¼


```python
def drop_outliers(data, col_name, scale = 1.5):
    """
    ç”¨äºæ¸…æ´—å¼‚å¸¸å€¼ï¼Œé»˜è®¤ç”¨ box_plotï¼ˆscale=1.5ï¼‰è¿›è¡Œæ¸…æ´—
    :param data: æ¥æ”¶ pandas æ•°æ®æ ¼å¼
    :param col_name: pandas åˆ—å
    :param scale: å°ºåº¦
    :return:
    """
    data_n = data.copy()
    data_series = data_n[col_name]
    
    IQR = scale * (data_series.quantile(0.75) - data_series.quantile(0.25)) # quantileæ˜¯pdå†…ç½®çš„æ±‚å››åˆ†ä½çš„å‡½æ•°
    val_low = data_series.quantile(0.25) - IQR # ä¸‹è¾¹ç¼˜
    val_up = data_series.quantile(0.75) + IQR # ä¸Šè¾¹ç¼˜
    rule_low = (data_series < val_low) # ä¸‹è¾¹ç¼˜çš„æå°å¼‚å¸¸å€¼çš„ä¸‹æ ‡åˆ—è¡¨
    rule_up = (data_series > val_up)   # ä¸Šè¾¹ç¼˜çš„æå¤§å¼‚å¸¸å€¼çš„ä¸‹æ ‡åˆ—è¡¨
    
    index = np.arange(data_series.shape[0])[rule_low | rule_up] # | è¿ç®—å°±æ˜¯è¯´åªè¦rule_lowå’Œrule_upä¸­åªè¦æœ‰ä¸€ä¸ªå€¼ä¸ºTrueï¼Œå°±æŠŠè¿™ä¸ªä¸‹æ ‡å–å‡ºæ¥
    print(index)
    print("Delete number is: {}".format(len(index)))
    
    data_n = data_n.drop(index) # åˆ é™¤indexå¯¹åº”ä¸‹æ ‡çš„å…ƒç´ 
    data_n.reset_index(drop=True, inplace=True) #ä¸‹æ–‡æœ‰ä»‹ç»
    print("Now column number is: {}".format(data_n.shape[0]))
    
    index_low = np.arange(data_series.shape[0])[rule_low] # ä¸‹è¾¹ç¼˜çš„å¼‚å¸¸æ•°æ®çš„æè¿°ç»Ÿè®¡é‡
    outliers = data_series.iloc[index_low]
    print("Description of data less than the lower bound is:")
    print(pd.Series(outliers).describe())
    
    index_up = np.arange(data_series.shape[0])[rule_up] # ä¸Šè¾¹ç¼˜çš„å¼‚å¸¸æ•°æ®çš„æè¿°ç»Ÿè®¡é‡
    outliers = data_series.iloc[index_up]
    print("Description of data larger than the upper bound is:")
    print(pd.Series(outliers).describe())
    
    fig, ax = plt.subplots(1, 2, figsize = (10, 7))
    sns.boxplot(y = data[col_name], data = data, palette = "Set1", ax = ax[0])
    sns.boxplot(y = data_n[col_name], data = data_n, palette = "Set1", ax = ax[1])
    return data_n
```

è¿™é‡Œ`reset_index`å¯ä»¥è¿˜åŸç´¢å¼•ï¼Œé‡æ–°å˜ä¸ºé»˜è®¤çš„æ•´å‹ç´¢å¼• 

`DataFrame.reset_index(level=None, drop=False, inplace=False, col_level=0, col_fill=â€)`

- `level`ï¼š`int`ã€`str`ã€`tuple`æˆ–`list`ï¼Œé»˜è®¤æ— ï¼Œä»…ä»ç´¢å¼•ä¸­åˆ é™¤ç»™å®šçº§åˆ«ã€‚é»˜è®¤æƒ…å†µä¸‹ç§»é™¤æ‰€æœ‰çº§åˆ«ã€‚æ§åˆ¶äº†å…·ä½“è¦è¿˜åŸçš„é‚£ä¸ªç­‰çº§çš„ç´¢å¼•
- `drop`ï¼š`drop`ä¸º`False`åˆ™ç´¢å¼•åˆ—ä¼šè¢«è¿˜åŸä¸ºæ™®é€šåˆ—ï¼Œå¦åˆ™ä¼šä¸¢å¤±
- `inplace`ï¼šé»˜è®¤ä¸º`False`ï¼Œé€‚å½“ä¿®æ”¹`DataFrame`(ä¸è¦åˆ›å»ºæ–°å¯¹è±¡)
- `col_level`ï¼š`int`æˆ–`str`ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œå¦‚æœåˆ—æœ‰å¤šä¸ªçº§åˆ«ï¼Œåˆ™ç¡®å®šå°†æ ‡ç­¾æ’å…¥åˆ°å“ªä¸ªçº§åˆ«ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†æ’å…¥åˆ°ç¬¬ä¸€çº§ã€‚
- `col_fill`ï¼šå¯¹è±¡ï¼Œé»˜è®¤â€˜â€™ï¼Œå¦‚æœåˆ—æœ‰å¤šä¸ªçº§åˆ«ï¼Œåˆ™ç¡®å®šå…¶ä»–çº§åˆ«çš„å‘½åæ–¹å¼ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™é‡å¤ç´¢å¼•å


```python
drop_outliers(train, 'power', scale=1.5)
```

    [    33     77    104 ... 149967 149981 149984]
    Delete number is: 4878
    Now column number is: 145122
    Description of data less than the lower bound is:
    count    0.0
    mean     NaN
    std      NaN
    min      NaN
    25%      NaN
    50%      NaN
    75%      NaN
    max      NaN
    Name: power, dtype: float64
    Description of data larger than the upper bound is:
    count     4878.000000
    mean       410.132021
    std        884.219933
    min        264.000000
    25%        286.000000
    50%        306.000000
    75%        349.000000
    max      19312.000000
    Name: power, dtype: float64
    




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SaleID</th>
      <th>name</th>
      <th>regDate</th>
      <th>model</th>
      <th>brand</th>
      <th>bodyType</th>
      <th>fuelType</th>
      <th>gearbox</th>
      <th>power</th>
      <th>kilometer</th>
      <th>...</th>
      <th>v_5</th>
      <th>v_6</th>
      <th>v_7</th>
      <th>v_8</th>
      <th>v_9</th>
      <th>v_10</th>
      <th>v_11</th>
      <th>v_12</th>
      <th>v_13</th>
      <th>v_14</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>736</td>
      <td>20040402</td>
      <td>30.0</td>
      <td>6</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>60</td>
      <td>12.5</td>
      <td>...</td>
      <td>0.235676</td>
      <td>0.101988</td>
      <td>0.129549</td>
      <td>0.022816</td>
      <td>0.097462</td>
      <td>-2.881803</td>
      <td>2.804097</td>
      <td>-2.420821</td>
      <td>0.795292</td>
      <td>0.914762</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>2262</td>
      <td>20030301</td>
      <td>40.0</td>
      <td>1</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0</td>
      <td>15.0</td>
      <td>...</td>
      <td>0.264777</td>
      <td>0.121004</td>
      <td>0.135731</td>
      <td>0.026597</td>
      <td>0.020582</td>
      <td>-4.900482</td>
      <td>2.096338</td>
      <td>-1.030483</td>
      <td>-1.722674</td>
      <td>0.245522</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2</td>
      <td>14874</td>
      <td>20040403</td>
      <td>115.0</td>
      <td>15</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>163</td>
      <td>12.5</td>
      <td>...</td>
      <td>0.251410</td>
      <td>0.114912</td>
      <td>0.165147</td>
      <td>0.062173</td>
      <td>0.027075</td>
      <td>-4.846749</td>
      <td>1.803559</td>
      <td>1.565330</td>
      <td>-0.832687</td>
      <td>-0.229963</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3</td>
      <td>71865</td>
      <td>19960908</td>
      <td>109.0</td>
      <td>10</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>193</td>
      <td>15.0</td>
      <td>...</td>
      <td>0.274293</td>
      <td>0.110300</td>
      <td>0.121964</td>
      <td>0.033395</td>
      <td>0.000000</td>
      <td>-4.509599</td>
      <td>1.285940</td>
      <td>-0.501868</td>
      <td>-2.438353</td>
      <td>-0.478699</td>
    </tr>
    <tr>
      <td>4</td>
      <td>4</td>
      <td>111080</td>
      <td>20120103</td>
      <td>110.0</td>
      <td>5</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>68</td>
      <td>5.0</td>
      <td>...</td>
      <td>0.228036</td>
      <td>0.073205</td>
      <td>0.091880</td>
      <td>0.078819</td>
      <td>0.121534</td>
      <td>-1.896240</td>
      <td>0.910783</td>
      <td>0.931110</td>
      <td>2.834518</td>
      <td>1.923482</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>145117</td>
      <td>149995</td>
      <td>163978</td>
      <td>20000607</td>
      <td>121.0</td>
      <td>10</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>163</td>
      <td>15.0</td>
      <td>...</td>
      <td>0.280264</td>
      <td>0.000310</td>
      <td>0.048441</td>
      <td>0.071158</td>
      <td>0.019174</td>
      <td>1.988114</td>
      <td>-2.983973</td>
      <td>0.589167</td>
      <td>-1.304370</td>
      <td>-0.302592</td>
    </tr>
    <tr>
      <td>145118</td>
      <td>149996</td>
      <td>184535</td>
      <td>20091102</td>
      <td>116.0</td>
      <td>11</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>125</td>
      <td>10.0</td>
      <td>...</td>
      <td>0.253217</td>
      <td>0.000777</td>
      <td>0.084079</td>
      <td>0.099681</td>
      <td>0.079371</td>
      <td>1.839166</td>
      <td>-2.774615</td>
      <td>2.553994</td>
      <td>0.924196</td>
      <td>-0.272160</td>
    </tr>
    <tr>
      <td>145119</td>
      <td>149997</td>
      <td>147587</td>
      <td>20101003</td>
      <td>60.0</td>
      <td>11</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>90</td>
      <td>6.0</td>
      <td>...</td>
      <td>0.233353</td>
      <td>0.000705</td>
      <td>0.118872</td>
      <td>0.100118</td>
      <td>0.097914</td>
      <td>2.439812</td>
      <td>-1.630677</td>
      <td>2.290197</td>
      <td>1.891922</td>
      <td>0.414931</td>
    </tr>
    <tr>
      <td>145120</td>
      <td>149998</td>
      <td>45907</td>
      <td>20060312</td>
      <td>34.0</td>
      <td>10</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>156</td>
      <td>15.0</td>
      <td>...</td>
      <td>0.256369</td>
      <td>0.000252</td>
      <td>0.081479</td>
      <td>0.083558</td>
      <td>0.081498</td>
      <td>2.075380</td>
      <td>-2.633719</td>
      <td>1.414937</td>
      <td>0.431981</td>
      <td>-1.659014</td>
    </tr>
    <tr>
      <td>145121</td>
      <td>149999</td>
      <td>177672</td>
      <td>19990204</td>
      <td>19.0</td>
      <td>28</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>193</td>
      <td>12.5</td>
      <td>...</td>
      <td>0.284475</td>
      <td>0.000000</td>
      <td>0.040072</td>
      <td>0.062543</td>
      <td>0.025819</td>
      <td>1.978453</td>
      <td>-3.179913</td>
      <td>0.031724</td>
      <td>-1.483350</td>
      <td>-0.342674</td>
    </tr>
  </tbody>
</table>
<p>145122 rows Ã— 31 columns</p>
</div>



![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200402004634297.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0V4Y2FsaWJ1clVsaW1pdGVk,size_16,color_FFFFFF,t_70#pic_center)


ä»è¿™å¼ åˆ é™¤å¼‚å¸¸å€¼å‰åçš„ç®±å‹å›¾å¯¹æ¯”å¯ä»¥çœ‹å‡ºï¼Œå‰”é™¤å¼‚å¸¸å€¼åï¼Œæ•°æ®çš„åˆ†å¸ƒå°±å¾ˆå‡åŒ€äº†ã€‚

ä¸‹é¢æˆ‘ä»¬å°±æ‰¹é‡å¯¹æ‰€æœ‰çš„ç‰¹å¾è¿›è¡Œä¸€æ¬¡å¼‚å¸¸æ•°æ®åˆ é™¤ï¼š


```python
def Bach_drop_outliers(data,scale=1.5):
    dataNew = data.copy()

    for fea in data.columns:
        try:
            IQR = scale * (dataNew[fea].quantile(0.75) - dataNew[fea].quantile(0.25)) # quantileæ˜¯pdå†…ç½®çš„æ±‚å››åˆ†ä½çš„å‡½æ•°
        except:
            continue
        val_low = dataNew[fea].quantile(0.25) - IQR # ä¸‹è¾¹ç¼˜
        val_up = dataNew[fea].quantile(0.75) + IQR # ä¸Šè¾¹ç¼˜
        rule_low = (dataNew[fea] < val_low) # ä¸‹è¾¹ç¼˜çš„æå°å¼‚å¸¸å€¼çš„ä¸‹æ ‡åˆ—è¡¨
        rule_up = (dataNew[fea] > val_up)   # ä¸Šè¾¹ç¼˜çš„æå¤§å¼‚å¸¸å€¼çš„ä¸‹æ ‡åˆ—è¡¨
        
        index = np.arange(dataNew[fea].shape[0])[rule_low | rule_up] # | è¿ç®—å°±æ˜¯è¯´åªè¦rule_lowå’Œrule_upä¸­åªè¦æœ‰ä¸€ä¸ªå€¼ä¸ºTrueï¼Œå°±æŠŠè¿™ä¸ªä¸‹æ ‡å–å‡ºæ¥
        print("feature %s deleted number is %d"%(fea, len(index)))
        
        dataNew = dataNew.drop(index)# åˆ é™¤indexå¯¹åº”ä¸‹æ ‡çš„å…ƒç´ 
        dataNew.reset_index(drop=True, inplace=True)
    fig, ax = plt.subplots(5, 6, figsize = (20, 15))
    x = 0
    y = 0
    for fea in dataNew.columns:
        try:
            sns.boxplot(y = dataNew[fea], data =dataNew, palette = "Set2", ax = ax[x][y])
            y+=1
            if y == 6:
                y = 0
                x += 1
        except:
            print(fea)
            y+=1
            if y == 6:
                y = 0
                x += 1
            continue
    return dataNew

train = Bach_drop_outliers(train)
```

    feature SaleID deleted number is 0
    feature name deleted number is 0
    feature regDate deleted number is 0
    feature model deleted number is 9720
    feature brand deleted number is 4032
    feature bodyType deleted number is 5458
    feature fuelType deleted number is 333
    feature gearbox deleted number is 26829
    feature power deleted number is 1506
    feature kilometer deleted number is 15306
    feature regionCode deleted number is 4
    feature seller deleted number is 1
    feature offerType deleted number is 0
    feature creatDate deleted number is 13989
    feature price deleted number is 4527
    feature v_0 deleted number is 2558
    feature v_1 deleted number is 0
    feature v_2 deleted number is 487
    feature v_3 deleted number is 173
    feature v_4 deleted number is 61
    feature v_5 deleted number is 0
    feature v_6 deleted number is 0
    feature v_7 deleted number is 64
    feature v_8 deleted number is 0
    feature v_9 deleted number is 24
    feature v_10 deleted number is 0
    feature v_11 deleted number is 0
    feature v_12 deleted number is 4
    feature v_13 deleted number is 0
    feature v_14 deleted number is 1944
    notRepairedDamage
    v_14
    


![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200402004549377.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0V4Y2FsaWJ1clVsaW1pdGVk,size_16,color_FFFFFF,t_70#pic_center)


å¯ä»¥çœ‹å‡ºï¼Œç»è¿‡ç®±å‹å›¾å¼‚å¸¸å€¼åˆ é™¤åï¼Œæ–°æ•°æ®çš„ç®±å‹å›¾çš„æ•°æ®å‡ ä¹æ²¡æœ‰å¼‚å¸¸å€¼äº†ï¼Œç”šè‡³æœ‰äº›ç®±å‹å›¾çš„æ•°æ®æ˜¯ä¸€æ¡ç›´çº¿ï¼Œå½“ç„¶é‚£æ˜¯å› ä¸ºæ•°æ®æœ¬èº«å°±æ˜¯ç§ç±»é0å³1ã€‚

## 2ï¸âƒ£ æ ‘æ¨¡å‹çš„ç‰¹å¾æ„é€ 
&emsp;&emsp;è®­ç»ƒé›†å’Œæµ‹è¯•é›†æ”¾åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿æ„é€ ç‰¹å¾


```python
train['train'] = 1
test['train'] = 0
data = pd.concat([train, test], ignore_index=True, sort=False)
data
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SaleID</th>
      <th>name</th>
      <th>regDate</th>
      <th>model</th>
      <th>brand</th>
      <th>bodyType</th>
      <th>fuelType</th>
      <th>gearbox</th>
      <th>power</th>
      <th>kilometer</th>
      <th>...</th>
      <th>v_6</th>
      <th>v_7</th>
      <th>v_8</th>
      <th>v_9</th>
      <th>v_10</th>
      <th>v_11</th>
      <th>v_12</th>
      <th>v_13</th>
      <th>v_14</th>
      <th>train</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1</td>
      <td>2262</td>
      <td>20030301</td>
      <td>40.0</td>
      <td>1</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0</td>
      <td>15.0</td>
      <td>...</td>
      <td>0.121004</td>
      <td>0.135731</td>
      <td>0.026597</td>
      <td>0.020582</td>
      <td>-4.900482</td>
      <td>2.096338</td>
      <td>-1.030483</td>
      <td>-1.722674</td>
      <td>0.245522</td>
      <td>1</td>
    </tr>
    <tr>
      <td>1</td>
      <td>5</td>
      <td>137642</td>
      <td>20090602</td>
      <td>24.0</td>
      <td>10</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>109</td>
      <td>10.0</td>
      <td>...</td>
      <td>0.000518</td>
      <td>0.119838</td>
      <td>0.090922</td>
      <td>0.048769</td>
      <td>1.885526</td>
      <td>-2.721943</td>
      <td>2.457660</td>
      <td>-0.286973</td>
      <td>0.206573</td>
      <td>1</td>
    </tr>
    <tr>
      <td>2</td>
      <td>7</td>
      <td>165346</td>
      <td>19990706</td>
      <td>26.0</td>
      <td>14</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>101</td>
      <td>15.0</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.122943</td>
      <td>0.039839</td>
      <td>0.082413</td>
      <td>3.693829</td>
      <td>-0.245014</td>
      <td>-2.192810</td>
      <td>0.236728</td>
      <td>0.195567</td>
      <td>1</td>
    </tr>
    <tr>
      <td>3</td>
      <td>10</td>
      <td>18961</td>
      <td>20050811</td>
      <td>19.0</td>
      <td>9</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>101</td>
      <td>15.0</td>
      <td>...</td>
      <td>0.105385</td>
      <td>0.077271</td>
      <td>0.042445</td>
      <td>0.060794</td>
      <td>-4.206000</td>
      <td>1.060391</td>
      <td>-0.647515</td>
      <td>-0.191194</td>
      <td>0.349187</td>
      <td>1</td>
    </tr>
    <tr>
      <td>4</td>
      <td>13</td>
      <td>8129</td>
      <td>20041110</td>
      <td>65.0</td>
      <td>1</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>150</td>
      <td>15.0</td>
      <td>...</td>
      <td>0.106950</td>
      <td>0.134945</td>
      <td>0.050364</td>
      <td>0.051359</td>
      <td>-4.614692</td>
      <td>0.821889</td>
      <td>0.753490</td>
      <td>-0.886425</td>
      <td>-0.341562</td>
      <td>1</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>112975</td>
      <td>199995</td>
      <td>20903</td>
      <td>19960503</td>
      <td>4.0</td>
      <td>4</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>116</td>
      <td>15.0</td>
      <td>...</td>
      <td>0.130044</td>
      <td>0.049833</td>
      <td>0.028807</td>
      <td>0.004616</td>
      <td>-5.978511</td>
      <td>1.303174</td>
      <td>-1.207191</td>
      <td>-1.981240</td>
      <td>-0.357695</td>
      <td>0</td>
    </tr>
    <tr>
      <td>112976</td>
      <td>199996</td>
      <td>708</td>
      <td>19991011</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>75</td>
      <td>15.0</td>
      <td>...</td>
      <td>0.108095</td>
      <td>0.066039</td>
      <td>0.025468</td>
      <td>0.025971</td>
      <td>-3.913825</td>
      <td>1.759524</td>
      <td>-2.075658</td>
      <td>-1.154847</td>
      <td>0.169073</td>
      <td>0</td>
    </tr>
    <tr>
      <td>112977</td>
      <td>199997</td>
      <td>6693</td>
      <td>20040412</td>
      <td>49.0</td>
      <td>1</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>224</td>
      <td>15.0</td>
      <td>...</td>
      <td>0.105724</td>
      <td>0.117652</td>
      <td>0.057479</td>
      <td>0.015669</td>
      <td>-4.639065</td>
      <td>0.654713</td>
      <td>1.137756</td>
      <td>-1.390531</td>
      <td>0.254420</td>
      <td>0</td>
    </tr>
    <tr>
      <td>112978</td>
      <td>199998</td>
      <td>96900</td>
      <td>20020008</td>
      <td>27.0</td>
      <td>1</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>334</td>
      <td>15.0</td>
      <td>...</td>
      <td>0.000490</td>
      <td>0.137366</td>
      <td>0.086216</td>
      <td>0.051383</td>
      <td>1.833504</td>
      <td>-2.828687</td>
      <td>2.465630</td>
      <td>-0.911682</td>
      <td>-2.057353</td>
      <td>0</td>
    </tr>
    <tr>
      <td>112979</td>
      <td>199999</td>
      <td>193384</td>
      <td>20041109</td>
      <td>166.0</td>
      <td>6</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>68</td>
      <td>9.0</td>
      <td>...</td>
      <td>0.000300</td>
      <td>0.103534</td>
      <td>0.080625</td>
      <td>0.124264</td>
      <td>2.914571</td>
      <td>-1.135270</td>
      <td>0.547628</td>
      <td>2.094057</td>
      <td>-1.552150</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>112980 rows Ã— 32 columns</p>
</div>



### 2ï¸âƒ£.1ï¸âƒ£ æ—¶é—´ç‰¹å¾æ„é€ 
- ä½¿ç”¨æ—¶é—´ï¼š`data['creatDate']` - `data['regDate']`ï¼Œååº”æ±½è½¦ä½¿ç”¨æ—¶é—´ï¼Œä¸€èˆ¬æ¥è¯´ä»·æ ¼ä¸ä½¿ç”¨æ—¶é—´æˆåæ¯”
- ä¸è¿‡è¦æ³¨æ„ï¼Œæ•°æ®é‡Œæœ‰æ—¶é—´å‡ºé”™çš„æ ¼å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ errors='coerce'


```python
data['used_time'] = (pd.to_datetime(data['creatDate'], format='%Y%m%d', errors='coerce') - 
                            pd.to_datetime(data['regDate'], format='%Y%m%d', errors='coerce')).dt.days
data['used_time']
```




    0         4757.0
    1         2482.0
    2         6108.0
    3         3874.0
    4         4154.0
               ...  
    112975    7261.0
    112976    6014.0
    112977    4345.0
    112978       NaN
    112979    4151.0
    Name: used_time, Length: 112980, dtype: float64



- çœ‹ä¸€ä¸‹ç©ºæ•°æ®ï¼Œæœ‰ 7.6k ä¸ªæ ·æœ¬çš„æ—¶é—´æ˜¯æœ‰é—®é¢˜çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åˆ é™¤ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æ”¾ç€ã€‚
- ä½†æ˜¯è¿™é‡Œä¸å»ºè®®åˆ é™¤ï¼Œå› ä¸ºåˆ é™¤ç¼ºå¤±æ•°æ®å æ€»æ ·æœ¬é‡è¿‡å¤§ï¼Œ3.8%
- æˆ‘ä»¬å¯ä»¥å…ˆæ”¾ç€ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬ XGBoost ä¹‹ç±»çš„å†³ç­–æ ‘ï¼Œå…¶æœ¬èº«å°±èƒ½å¤„ç†ç¼ºå¤±å€¼ï¼Œæ‰€ä»¥å¯ä»¥ä¸ç”¨ç®¡ï¼›


```python
data['used_time'].isnull().sum()
```




    8591




```python
data.isnull().sum().sum()
```




    70585



### 2ï¸âƒ£.2ï¸âƒ£ åŸå¸‚ä¿¡æ¯ç‰¹å¾æå–
- ä»é‚®ç¼–ä¸­æå–åŸå¸‚ä¿¡æ¯ï¼Œå› ä¸ºæ˜¯å¾·å›½çš„æ•°æ®ï¼Œæ‰€ä»¥å‚è€ƒå¾·å›½çš„é‚®ç¼–ï¼Œç›¸å½“äºåŠ å…¥äº†å…ˆéªŒçŸ¥è¯†


```python
data['city'] = data['regionCode'].apply(lambda x : str(x)[:-3])
data['city']
```




    0         4
    1         3
    2         4
    3         1
    4         3
             ..
    112975    3
    112976    1
    112977    3
    112978    1
    112979    3
    Name: city, Length: 112980, dtype: object



### 2ï¸âƒ£.3ï¸âƒ£ å“ç‰Œç‰¹å¾æå–
&emsp;&emsp;è®¡ç®—æŸå“ç‰Œçš„é”€å”®ç»Ÿè®¡é‡ï¼Œè¿™é‡Œè¦ä»¥ train çš„æ•°æ®è®¡ç®—ç»Ÿè®¡é‡ã€‚


```python
train_gb = train.groupby("brand")
all_info = {}
for kind, kind_data in train_gb:
    info = {}
    kind_data = kind_data[kind_data['price'] > 0] # kind_data['price'] > 0 è¿”å›çš„æ˜¯ä¸‹æ ‡å†å–ä¸€æ¬¡åˆ—è¡¨å°±å¾—åˆ°äº†æ•°æ®
    info['brand_amount'] = len(kind_data)
    info['brand_price_max'] = kind_data.price.max()
    info['brand_price_median'] = kind_data.price.median()
    info['brand_price_min'] = kind_data.price.min()
    info['brand_price_sum'] = kind_data.price.sum()
    info['brand_price_std'] = kind_data.price.std()
    info['brand_price_average'] = round(kind_data.price.sum() / (len(kind_data) + 1), 2)
    all_info[kind] = info
brand_fe = pd.DataFrame(all_info).T.reset_index().rename(columns={"index": "brand"})
data = data.merge(brand_fe, how='left', on='brand')
data
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SaleID</th>
      <th>name</th>
      <th>regDate</th>
      <th>model</th>
      <th>brand</th>
      <th>bodyType</th>
      <th>fuelType</th>
      <th>gearbox</th>
      <th>power</th>
      <th>kilometer</th>
      <th>...</th>
      <th>train</th>
      <th>used_time</th>
      <th>city</th>
      <th>brand_amount</th>
      <th>brand_price_max</th>
      <th>brand_price_median</th>
      <th>brand_price_min</th>
      <th>brand_price_sum</th>
      <th>brand_price_std</th>
      <th>brand_price_average</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1</td>
      <td>2262</td>
      <td>20030301</td>
      <td>40.0</td>
      <td>1</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0</td>
      <td>15.0</td>
      <td>...</td>
      <td>1</td>
      <td>4757.0</td>
      <td>4</td>
      <td>4940.0</td>
      <td>9500.0</td>
      <td>2999.0</td>
      <td>149.0</td>
      <td>17934852.0</td>
      <td>2537.956443</td>
      <td>3629.80</td>
    </tr>
    <tr>
      <td>1</td>
      <td>5</td>
      <td>137642</td>
      <td>20090602</td>
      <td>24.0</td>
      <td>10</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>109</td>
      <td>10.0</td>
      <td>...</td>
      <td>1</td>
      <td>2482.0</td>
      <td>3</td>
      <td>3557.0</td>
      <td>9500.0</td>
      <td>2490.0</td>
      <td>200.0</td>
      <td>10936962.0</td>
      <td>2180.881827</td>
      <td>3073.91</td>
    </tr>
    <tr>
      <td>2</td>
      <td>7</td>
      <td>165346</td>
      <td>19990706</td>
      <td>26.0</td>
      <td>14</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>101</td>
      <td>15.0</td>
      <td>...</td>
      <td>1</td>
      <td>6108.0</td>
      <td>4</td>
      <td>8784.0</td>
      <td>9500.0</td>
      <td>1350.0</td>
      <td>13.0</td>
      <td>17445064.0</td>
      <td>1797.704405</td>
      <td>1985.78</td>
    </tr>
    <tr>
      <td>3</td>
      <td>10</td>
      <td>18961</td>
      <td>20050811</td>
      <td>19.0</td>
      <td>9</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>101</td>
      <td>15.0</td>
      <td>...</td>
      <td>1</td>
      <td>3874.0</td>
      <td>1</td>
      <td>4487.0</td>
      <td>9500.0</td>
      <td>1250.0</td>
      <td>55.0</td>
      <td>7867901.0</td>
      <td>1556.621159</td>
      <td>1753.10</td>
    </tr>
    <tr>
      <td>4</td>
      <td>13</td>
      <td>8129</td>
      <td>20041110</td>
      <td>65.0</td>
      <td>1</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>150</td>
      <td>15.0</td>
      <td>...</td>
      <td>1</td>
      <td>4154.0</td>
      <td>3</td>
      <td>4940.0</td>
      <td>9500.0</td>
      <td>2999.0</td>
      <td>149.0</td>
      <td>17934852.0</td>
      <td>2537.956443</td>
      <td>3629.80</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>112975</td>
      <td>199995</td>
      <td>20903</td>
      <td>19960503</td>
      <td>4.0</td>
      <td>4</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>116</td>
      <td>15.0</td>
      <td>...</td>
      <td>0</td>
      <td>7261.0</td>
      <td>3</td>
      <td>6368.0</td>
      <td>9500.0</td>
      <td>3000.0</td>
      <td>150.0</td>
      <td>24046576.0</td>
      <td>2558.650243</td>
      <td>3775.57</td>
    </tr>
    <tr>
      <td>112976</td>
      <td>199996</td>
      <td>708</td>
      <td>19991011</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>75</td>
      <td>15.0</td>
      <td>...</td>
      <td>0</td>
      <td>6014.0</td>
      <td>1</td>
      <td>16371.0</td>
      <td>9500.0</td>
      <td>2150.0</td>
      <td>50.0</td>
      <td>46735356.0</td>
      <td>2276.755156</td>
      <td>2854.59</td>
    </tr>
    <tr>
      <td>112977</td>
      <td>199997</td>
      <td>6693</td>
      <td>20040412</td>
      <td>49.0</td>
      <td>1</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>224</td>
      <td>15.0</td>
      <td>...</td>
      <td>0</td>
      <td>4345.0</td>
      <td>3</td>
      <td>4940.0</td>
      <td>9500.0</td>
      <td>2999.0</td>
      <td>149.0</td>
      <td>17934852.0</td>
      <td>2537.956443</td>
      <td>3629.80</td>
    </tr>
    <tr>
      <td>112978</td>
      <td>199998</td>
      <td>96900</td>
      <td>20020008</td>
      <td>27.0</td>
      <td>1</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>334</td>
      <td>15.0</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>1</td>
      <td>4940.0</td>
      <td>9500.0</td>
      <td>2999.0</td>
      <td>149.0</td>
      <td>17934852.0</td>
      <td>2537.956443</td>
      <td>3629.80</td>
    </tr>
    <tr>
      <td>112979</td>
      <td>199999</td>
      <td>193384</td>
      <td>20041109</td>
      <td>166.0</td>
      <td>6</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>68</td>
      <td>9.0</td>
      <td>...</td>
      <td>0</td>
      <td>4151.0</td>
      <td>3</td>
      <td>5778.0</td>
      <td>9500.0</td>
      <td>1400.0</td>
      <td>50.0</td>
      <td>11955982.0</td>
      <td>1871.933447</td>
      <td>2068.87</td>
    </tr>
  </tbody>
</table>
<p>112980 rows Ã— 41 columns</p>
</div>




```python
brand_fe
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>brand</th>
      <th>brand_amount</th>
      <th>brand_price_max</th>
      <th>brand_price_median</th>
      <th>brand_price_min</th>
      <th>brand_price_sum</th>
      <th>brand_price_std</th>
      <th>brand_price_average</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>16371.0</td>
      <td>9500.0</td>
      <td>2150.0</td>
      <td>50.0</td>
      <td>46735356.0</td>
      <td>2276.755156</td>
      <td>2854.59</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>4940.0</td>
      <td>9500.0</td>
      <td>2999.0</td>
      <td>149.0</td>
      <td>17934852.0</td>
      <td>2537.956443</td>
      <td>3629.80</td>
    </tr>
    <tr>
      <td>2</td>
      <td>3</td>
      <td>665.0</td>
      <td>9500.0</td>
      <td>2800.0</td>
      <td>99.0</td>
      <td>2158773.0</td>
      <td>2058.532395</td>
      <td>3241.40</td>
    </tr>
    <tr>
      <td>3</td>
      <td>4</td>
      <td>6368.0</td>
      <td>9500.0</td>
      <td>3000.0</td>
      <td>150.0</td>
      <td>24046576.0</td>
      <td>2558.650243</td>
      <td>3775.57</td>
    </tr>
    <tr>
      <td>4</td>
      <td>5</td>
      <td>2842.0</td>
      <td>9500.0</td>
      <td>1850.0</td>
      <td>75.0</td>
      <td>6562224.0</td>
      <td>1738.415572</td>
      <td>2308.20</td>
    </tr>
    <tr>
      <td>5</td>
      <td>6</td>
      <td>5778.0</td>
      <td>9500.0</td>
      <td>1400.0</td>
      <td>50.0</td>
      <td>11955982.0</td>
      <td>1871.933447</td>
      <td>2068.87</td>
    </tr>
    <tr>
      <td>6</td>
      <td>7</td>
      <td>1035.0</td>
      <td>9500.0</td>
      <td>1500.0</td>
      <td>100.0</td>
      <td>2372550.0</td>
      <td>2071.320262</td>
      <td>2290.11</td>
    </tr>
    <tr>
      <td>7</td>
      <td>8</td>
      <td>705.0</td>
      <td>9500.0</td>
      <td>1100.0</td>
      <td>125.0</td>
      <td>1077211.0</td>
      <td>1318.748474</td>
      <td>1525.79</td>
    </tr>
    <tr>
      <td>8</td>
      <td>9</td>
      <td>4487.0</td>
      <td>9500.0</td>
      <td>1250.0</td>
      <td>55.0</td>
      <td>7867901.0</td>
      <td>1556.621159</td>
      <td>1753.10</td>
    </tr>
    <tr>
      <td>9</td>
      <td>10</td>
      <td>3557.0</td>
      <td>9500.0</td>
      <td>2490.0</td>
      <td>200.0</td>
      <td>10936962.0</td>
      <td>2180.881827</td>
      <td>3073.91</td>
    </tr>
    <tr>
      <td>10</td>
      <td>11</td>
      <td>1390.0</td>
      <td>9500.0</td>
      <td>1750.0</td>
      <td>50.0</td>
      <td>3513591.0</td>
      <td>2151.572044</td>
      <td>2525.95</td>
    </tr>
    <tr>
      <td>11</td>
      <td>12</td>
      <td>549.0</td>
      <td>9500.0</td>
      <td>1850.0</td>
      <td>100.0</td>
      <td>1413264.0</td>
      <td>2091.218447</td>
      <td>2569.57</td>
    </tr>
    <tr>
      <td>12</td>
      <td>13</td>
      <td>1689.0</td>
      <td>8950.0</td>
      <td>1250.0</td>
      <td>25.0</td>
      <td>2832005.0</td>
      <td>1363.018568</td>
      <td>1675.74</td>
    </tr>
    <tr>
      <td>13</td>
      <td>14</td>
      <td>8784.0</td>
      <td>9500.0</td>
      <td>1350.0</td>
      <td>13.0</td>
      <td>17445064.0</td>
      <td>1797.704405</td>
      <td>1985.78</td>
    </tr>
    <tr>
      <td>14</td>
      <td>15</td>
      <td>389.0</td>
      <td>9500.0</td>
      <td>5700.0</td>
      <td>1800.0</td>
      <td>2247357.0</td>
      <td>1795.404288</td>
      <td>5762.45</td>
    </tr>
    <tr>
      <td>15</td>
      <td>16</td>
      <td>291.0</td>
      <td>8900.0</td>
      <td>1950.0</td>
      <td>300.0</td>
      <td>636703.0</td>
      <td>1223.490908</td>
      <td>2180.49</td>
    </tr>
    <tr>
      <td>16</td>
      <td>17</td>
      <td>542.0</td>
      <td>9500.0</td>
      <td>1970.0</td>
      <td>150.0</td>
      <td>1444129.0</td>
      <td>2136.402905</td>
      <td>2659.54</td>
    </tr>
    <tr>
      <td>17</td>
      <td>18</td>
      <td>66.0</td>
      <td>8990.0</td>
      <td>1650.0</td>
      <td>150.0</td>
      <td>167360.0</td>
      <td>2514.210817</td>
      <td>2497.91</td>
    </tr>
    <tr>
      <td>18</td>
      <td>19</td>
      <td>341.0</td>
      <td>9100.0</td>
      <td>1200.0</td>
      <td>130.0</td>
      <td>540335.0</td>
      <td>1337.203100</td>
      <td>1579.93</td>
    </tr>
    <tr>
      <td>19</td>
      <td>20</td>
      <td>514.0</td>
      <td>8150.0</td>
      <td>1200.0</td>
      <td>100.0</td>
      <td>818973.0</td>
      <td>1276.623577</td>
      <td>1590.24</td>
    </tr>
    <tr>
      <td>20</td>
      <td>21</td>
      <td>527.0</td>
      <td>8900.0</td>
      <td>1890.0</td>
      <td>99.0</td>
      <td>1285258.0</td>
      <td>1832.524896</td>
      <td>2434.20</td>
    </tr>
    <tr>
      <td>21</td>
      <td>22</td>
      <td>222.0</td>
      <td>9300.0</td>
      <td>1925.0</td>
      <td>190.0</td>
      <td>592296.0</td>
      <td>2118.280894</td>
      <td>2656.04</td>
    </tr>
    <tr>
      <td>22</td>
      <td>23</td>
      <td>68.0</td>
      <td>9500.0</td>
      <td>1194.5</td>
      <td>100.0</td>
      <td>110253.0</td>
      <td>1754.883573</td>
      <td>1597.87</td>
    </tr>
    <tr>
      <td>23</td>
      <td>24</td>
      <td>4.0</td>
      <td>8600.0</td>
      <td>7550.0</td>
      <td>5999.0</td>
      <td>29699.0</td>
      <td>1072.435041</td>
      <td>5939.80</td>
    </tr>
    <tr>
      <td>24</td>
      <td>25</td>
      <td>735.0</td>
      <td>9500.0</td>
      <td>1500.0</td>
      <td>100.0</td>
      <td>1725999.0</td>
      <td>2152.726491</td>
      <td>2345.11</td>
    </tr>
    <tr>
      <td>25</td>
      <td>26</td>
      <td>121.0</td>
      <td>9500.0</td>
      <td>2699.0</td>
      <td>300.0</td>
      <td>417260.0</td>
      <td>2563.586943</td>
      <td>3420.16</td>
    </tr>
  </tbody>
</table>
</div>



## 3ï¸âƒ£ æ ‘æ¨¡å‹çš„æ•°æ®åˆ†æ¡¶
&emsp;&emsp;æ•°æ®åˆ†ç®±ï¼ˆä¹Ÿç§°ä¸ºç¦»æ•£åˆ†ç®±æˆ–åˆ†æ®µï¼‰æ˜¯ä¸€ç§æ•°æ®é¢„å¤„ç†æŠ€æœ¯ï¼Œç”¨äºå‡å°‘æ¬¡è¦è§‚å¯Ÿè¯¯å·®çš„å½±å“ï¼Œæ˜¯ä¸€ç§å°†å¤šä¸ªè¿ç»­å€¼åˆ†ç»„ä¸ºè¾ƒå°‘æ•°é‡çš„â€œåˆ†ç®±â€çš„æ–¹æ³•ã€‚ä¾‹å¦‚æˆ‘ä»¬æœ‰å„ä¸ªå¹´é¾„çš„æ•°æ®çš„ç»Ÿè®¡å€¼ï¼Œå¯ä»¥åˆ†æˆæŸä¸ªæ®µçš„å¹´é¾„çš„å€¼ã€‚
1. ç¦»æ•£åç¨€ç–å‘é‡å†…ç§¯ä¹˜æ³•è¿ç®—é€Ÿåº¦æ›´å¿«ï¼Œè®¡ç®—ç»“æœä¹Ÿæ–¹ä¾¿å­˜å‚¨ï¼Œå®¹æ˜“æ‰©å±•ï¼›
2. ç¦»æ•£åçš„ç‰¹å¾å¯¹å¼‚å¸¸å€¼æ›´å…·é²æ£’æ€§ï¼Œå¦‚ age>30 ä¸º 1 å¦åˆ™ä¸º 0ï¼Œå¯¹äºå¹´é¾„ä¸º 200 çš„ä¹Ÿä¸ä¼šå¯¹æ¨¡å‹é€ æˆå¾ˆå¤§çš„å¹²æ‰°ï¼›
3. LR å±äºå¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼Œè¡¨è¾¾èƒ½åŠ›æœ‰é™ï¼Œç»è¿‡ç¦»æ•£åŒ–åï¼Œæ¯ä¸ªå˜é‡æœ‰å•ç‹¬çš„æƒé‡ï¼Œè¿™ç›¸å½“äºå¼•å…¥äº†éçº¿æ€§ï¼Œèƒ½å¤Ÿæå‡æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ï¼ŒåŠ å¤§æ‹Ÿåˆï¼›
4. ç¦»æ•£åç‰¹å¾å¯ä»¥è¿›è¡Œç‰¹å¾äº¤å‰ï¼Œæå‡è¡¨è¾¾èƒ½åŠ›ï¼Œç”± M+N ä¸ªå˜é‡å˜æˆ M*N ä¸ªå˜é‡ï¼Œè¿›ä¸€æ­¥å¼•å…¥éçº¿å½¢ï¼Œæå‡äº†è¡¨è¾¾èƒ½åŠ›ï¼›
5. ç‰¹å¾ç¦»æ•£åæ¨¡å‹æ›´ç¨³å®šï¼Œå¦‚ç”¨æˆ·å¹´é¾„åŒºé—´ï¼Œä¸ä¼šå› ä¸ºç”¨æˆ·å¹´é¾„é•¿äº†ä¸€å²å°±å˜åŒ–

ä¸‹é¢ä»¥`power`ä¸ºä¾‹å­ï¼Œåšä¸€æ¬¡æ•°æ®åˆ†æ¡¶


```python
bin = [i*10 for i in range(31)]
data['power_bin'] = pd.cut(data['power'], bin, labels=False)
data[['power_bin', 'power']]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>power_bin</th>
      <th>power</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <td>1</td>
      <td>10.0</td>
      <td>109</td>
    </tr>
    <tr>
      <td>2</td>
      <td>10.0</td>
      <td>101</td>
    </tr>
    <tr>
      <td>3</td>
      <td>10.0</td>
      <td>101</td>
    </tr>
    <tr>
      <td>4</td>
      <td>14.0</td>
      <td>150</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>112975</td>
      <td>11.0</td>
      <td>116</td>
    </tr>
    <tr>
      <td>112976</td>
      <td>7.0</td>
      <td>75</td>
    </tr>
    <tr>
      <td>112977</td>
      <td>22.0</td>
      <td>224</td>
    </tr>
    <tr>
      <td>112978</td>
      <td>NaN</td>
      <td>334</td>
    </tr>
    <tr>
      <td>112979</td>
      <td>6.0</td>
      <td>68</td>
    </tr>
  </tbody>
</table>
<p>112980 rows Ã— 2 columns</p>
</div>



å¯ä»¥çœ‹å‡ºè¿™ä¸ªåˆ†ç®±çš„ä½œç”¨å°±æ˜¯å°†åŒä¸€ä¸ªåŒºé—´æ®µçš„åŠŸç‡å€¼è®¾ä¸ºåŒæ ·çš„å€¼ï¼Œæ¯”å¦‚101~109éƒ½è®¾ç½®ä¸º10.0ã€‚
ç„¶åå°±å¯ä»¥åˆ é™¤æ‰åŸæ•°æ®äº†ï¼š


```python
data = data.drop(['creatDate', 'regDate', 'regionCode'], axis=1)
```


```python
print(data.shape)
data.columns
```

    (112980, 39)
    




    Index(['SaleID', 'name', 'model', 'brand', 'bodyType', 'fuelType', 'gearbox',
           'power', 'kilometer', 'notRepairedDamage', 'seller', 'offerType',
           'price', 'v_0', 'v_1', 'v_2', 'v_3', 'v_4', 'v_5', 'v_6', 'v_7', 'v_8',
           'v_9', 'v_10', 'v_11', 'v_12', 'v_13', 'v_14', 'train', 'used_time',
           'city', 'brand_amount', 'brand_price_max', 'brand_price_median',
           'brand_price_min', 'brand_price_sum', 'brand_price_std',
           'brand_price_average', 'power_bin'],
          dtype='object')



è‡³æ­¤ï¼Œå¯ä»¥å¯¼å‡ºç»™æ ‘æ¨¡å‹ç”¨çš„æ•°æ®


```python
data.to_csv('data_for_tree.csv', index=0)
```

## 4ï¸âƒ£ LRä¸NNæ¨¡å‹çš„ç‰¹å¾æ„é€ 
&emsp;&emsp;ä¸Šé¢çš„æ­¥éª¤å°±æ˜¯ä¸€æ¬¡æ¯”è¾ƒå®Œå¤‡çš„ç‰¹å¾æ„é€ ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸ºå…¶ä»–æ¨¡å‹æ„é€ ç‰¹å¾ï¼Œä¸»è¦æ˜¯ç”±äºä¸ç”¨æ¨¡å‹éœ€è¦çš„æ•°æ®è¾“å…¥æ˜¯ä¸åŒçš„ã€‚

### 4ï¸âƒ£.1ï¸âƒ£ $log$ä¸å½’ä¸€åŒ–
è§‚å¯Ÿä¸€ä¸‹æ•°æ®åˆ†å¸ƒ


```python
data['power'].plot.hist()
```




    <matplotlib.axes._subplots.AxesSubplot at 0x2108b6377b8>


![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200402004706243.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0V4Y2FsaWJ1clVsaW1pdGVk,size_16,color_FFFFFF,t_70#pic_center)



å†çœ‹çœ‹`train`æ•°æ®é›†çš„åˆ†å¸ƒï¼š


```python
train['power'].plot.hist()
```




    <matplotlib.axes._subplots.AxesSubplot at 0x2108b4ed588>



![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200402004719447.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0V4Y2FsaWJ1clVsaW1pdGVk,size_16,color_FFFFFF,t_70#pic_center)

æˆ‘ä»¬å¯¹å…¶å– logï¼Œå†åšå½’ä¸€åŒ–


```python
data['power'] = np.log(data['power'] + 1) 
data['power'] = ((data['power'] - np.min(data['power'])) / (np.max(data['power']) - np.min(data['power'])))
data['power'].plot.hist()
```




    <matplotlib.axes._subplots.AxesSubplot at 0x2108abc1438>




![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200402004913553.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0V4Y2FsaWJ1clVsaW1pdGVk,size_16,color_FFFFFF,t_70#pic_center)


çœ‹çœ‹è¡Œé©¶é‡Œç¨‹çš„æƒ…å†µï¼Œåº”è¯¥æ˜¯åŸå§‹æ•°æ®å·²ç»åˆ†å¥½äº†æ¡¶


```python
data['kilometer'].plot.hist()
```




    <matplotlib.axes._subplots.AxesSubplot at 0x2108abc1390>




![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200402004748777.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0V4Y2FsaWJ1clVsaW1pdGVk,size_16,color_FFFFFF,t_70#pic_center)

å½’ä¸€åŒ–


```python
data['kilometer'] = ((data['kilometer'] - np.min(data['kilometer'])) / 
                        (np.max(data['kilometer']) - np.min(data['kilometer'])))
data['kilometer'].plot.hist()
```




    <matplotlib.axes._subplots.AxesSubplot at 0x2108aca0898>


![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200402004923471.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0V4Y2FsaWJ1clVsaW1pdGVk,size_16,color_FFFFFF,t_70#pic_center)




å¯¹åˆšåˆšæ„é€ çš„ç»Ÿè®¡é‡è¿›è¡Œå½’ä¸€åŒ–


```python
def max_min(x):
    return (x - np.min(x)) / (np.max(x) - np.min(x))

data.columns[-10:]
```




    Index(['used_time', 'city', 'brand_amount', 'brand_price_max',
           'brand_price_median', 'brand_price_min', 'brand_price_sum',
           'brand_price_std', 'brand_price_average', 'power_bin'],
          dtype='object')




```python
for i in data.columns[-10:]:
    if np.min(data[i]) != '': # å­˜åœ¨ç©ºå€¼çš„æƒ…å†µ
        data[i] = max_min(data[i])
```

### 4ï¸âƒ£.2ï¸âƒ£ $OneEncoder$ç¼–ç 
&emsp;&emsp;å¯¹ç±»åˆ«ç‰¹å¾è¿›è¡Œ$OneEncoder$<br>
åœ¨æ­¤ä¹‹å‰å…ˆä»‹ç»ä¸€ä¸‹$OneEncoder$ç¼–ç :$one-hot$çš„åŸºæœ¬æ€æƒ³ï¼Œå°†ç¦»æ•£å‹ç‰¹å¾çš„æ¯ä¸€ç§å–å€¼éƒ½çœ‹æˆä¸€ç§çŠ¶æ€ï¼Œè‹¥ä½ çš„è¿™ä¸€ç‰¹å¾ä¸­æœ‰$N$ä¸ªä¸ç›¸åŒçš„å–å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†è¯¥ç‰¹å¾æŠ½è±¡æˆ$N$ç§ä¸åŒçš„çŠ¶æ€ï¼Œ$one-hot$ç¼–ç ä¿è¯äº†æ¯ä¸€ä¸ªå–å€¼åªä¼šä½¿å¾—ä¸€ç§çŠ¶æ€å¤„äºâ€œæ¿€æ´»æ€â€ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™Nç§çŠ¶æ€ä¸­åªæœ‰ä¸€ä¸ªçŠ¶æ€ä½å€¼ä¸º1ï¼Œå…¶ä»–çŠ¶æ€ä½éƒ½æ˜¯0ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬ä»¥å­¦å†ä¸ºä¾‹ï¼Œæˆ‘ä»¬æƒ³è¦ç ”ç©¶çš„ç±»åˆ«ä¸ºå°å­¦ã€ä¸­å­¦ã€å¤§å­¦ã€ç¡•å£«ã€åšå£«äº”ç§ç±»åˆ«ï¼Œæˆ‘ä»¬ä½¿ç”¨$one-hot$å¯¹å…¶ç¼–ç å°±ä¼šå¾—åˆ°ï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200402004945672.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0V4Y2FsaWJ1clVsaW1pdGVk,size_16,color_FFFFFF,t_70#pic_center)

- $dummy \quad encoding$

å“‘å˜é‡ç¼–ç ç›´è§‚çš„è§£é‡Šå°±æ˜¯ä»»æ„çš„å°†ä¸€ä¸ªçŠ¶æ€ä½å»é™¤ã€‚è¿˜æ˜¯æ‹¿ä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œæˆ‘ä»¬ç”¨4ä¸ªçŠ¶æ€ä½å°±è¶³å¤Ÿååº”ä¸Šè¿°5ä¸ªç±»åˆ«çš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä»…ä»…ä½¿ç”¨å‰å››ä¸ªçŠ¶æ€ä½ [0,0,0,0] å°±å¯ä»¥è¡¨è¾¾åšå£«äº†ã€‚åªæ˜¯å› ä¸ºå¯¹äºä¸€ä¸ªæˆ‘ä»¬ç ”ç©¶çš„æ ·æœ¬ï¼Œä»–å·²ä¸æ˜¯å°å­¦ç”Ÿã€ä¹Ÿä¸æ˜¯ä¸­å­¦ç”Ÿã€ä¹Ÿä¸æ˜¯å¤§å­¦ç”Ÿã€åˆä¸æ˜¯ç ”ç©¶ç”Ÿï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é»˜è®¤ä»–æ˜¯åšå£«ï¼Œæ˜¯ä¸æ˜¯ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ç”¨å“‘å˜é‡ç¼–ç å¯ä»¥å°†ä¸Šè¿°5ç±»è¡¨ç¤ºæˆï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200402004956905.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0V4Y2FsaWJ1clVsaW1pdGVk,size_16,color_FFFFFF,t_70#pic_center)



```python
data = pd.get_dummies(data, columns=['model', 'brand', 'bodyType', 'fuelType',
                                     'gearbox', 'notRepairedDamage', 'power_bin'])
data
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SaleID</th>
      <th>name</th>
      <th>power</th>
      <th>kilometer</th>
      <th>seller</th>
      <th>offerType</th>
      <th>price</th>
      <th>v_0</th>
      <th>v_1</th>
      <th>v_2</th>
      <th>...</th>
      <th>power_bin_0.6896551724137931</th>
      <th>power_bin_0.7241379310344828</th>
      <th>power_bin_0.7586206896551724</th>
      <th>power_bin_0.7931034482758621</th>
      <th>power_bin_0.8275862068965517</th>
      <th>power_bin_0.8620689655172413</th>
      <th>power_bin_0.896551724137931</th>
      <th>power_bin_0.9310344827586207</th>
      <th>power_bin_0.9655172413793104</th>
      <th>power_bin_1.0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1</td>
      <td>2262</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>3600.0</td>
      <td>45.305273</td>
      <td>5.236112</td>
      <td>0.137925</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>1</td>
      <td>5</td>
      <td>137642</td>
      <td>0.474626</td>
      <td>0.655172</td>
      <td>0</td>
      <td>0</td>
      <td>8000.0</td>
      <td>46.323165</td>
      <td>-3.229285</td>
      <td>0.156615</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>2</td>
      <td>7</td>
      <td>165346</td>
      <td>0.467002</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>1000.0</td>
      <td>42.255586</td>
      <td>-3.167771</td>
      <td>-0.676693</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>10</td>
      <td>18961</td>
      <td>0.467002</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>3100.0</td>
      <td>45.401241</td>
      <td>4.195311</td>
      <td>-0.370513</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>4</td>
      <td>13</td>
      <td>8129</td>
      <td>0.506615</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>3100.0</td>
      <td>46.844574</td>
      <td>4.175332</td>
      <td>0.490609</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>112975</td>
      <td>199995</td>
      <td>20903</td>
      <td>0.480856</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>45.621391</td>
      <td>5.958453</td>
      <td>-0.918571</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>112976</td>
      <td>199996</td>
      <td>708</td>
      <td>0.437292</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>43.935162</td>
      <td>4.476841</td>
      <td>-0.841710</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>112977</td>
      <td>199997</td>
      <td>6693</td>
      <td>0.546885</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>46.537137</td>
      <td>4.170806</td>
      <td>0.388595</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>112978</td>
      <td>199998</td>
      <td>96900</td>
      <td>0.587076</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>46.771359</td>
      <td>-3.296814</td>
      <td>0.243566</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>112979</td>
      <td>199999</td>
      <td>193384</td>
      <td>0.427535</td>
      <td>0.586207</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>43.731010</td>
      <td>-3.121867</td>
      <td>0.027348</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>112980 rows Ã— 369 columns</p>
</div>



- å°†è¿™ä»½æ•°æ®è¾“å‡ºç»™LRæ¨¡å‹ä½¿ç”¨


```python
data.to_csv('data_for_lr.csv', index=0)
```

## 5ï¸âƒ£ ç‰¹å¾é€‰æ‹©
### 5ï¸âƒ£.1ï¸âƒ£ è¿‡æ»¤å¼(filter)
ç›¸å…³æ€§åˆ†æ


```python
print(data['power'].corr(data['price'], method='spearman'))
print(data['kilometer'].corr(data['price'], method='spearman'))
print(data['brand_amount'].corr(data['price'], method='spearman'))
print(data['brand_price_average'].corr(data['price'], method='spearman'))
print(data['brand_price_max'].corr(data['price'], method='spearman'))
print(data['brand_price_median'].corr(data['price'], method='spearman'))
```

    0.4698539569820024
    -0.19974282513118508
    0.04085800320025127
    0.3135239590412946
    0.07894119089254827
    0.3138873049004745
    

å¯ä»¥çœ‹å‡º`power`ï¼Œ`brand_price_average`ï¼Œ`brand_price_median`ä¸`price`ç›¸å…³æ€§æ¯”è¾ƒé«˜


```python
data_numeric = data[['power', 'kilometer', 'brand_amount', 'brand_price_average', 
                     'brand_price_max', 'brand_price_median']]
correlation = data_numeric.corr()

f , ax = plt.subplots(figsize = (7, 7))
plt.title('Correlation of Numeric Features with Price',y=1,size=30)
sns.heatmap(correlation, square = True, cmap = 'PuBuGn', vmax=0.8)
```




    <matplotlib.axes._subplots.AxesSubplot at 0x21096f60198>




![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200402005026878.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0V4Y2FsaWJ1clVsaW1pdGVk,size_16,color_FFFFFF,t_70#pic_center)


çœ‹ä¸å‡ºæ¥å•¥ã€‚ğŸ˜›

### 5ï¸âƒ£.2ï¸âƒ£ åŒ…è£¹å¼(wrapper)


```python
!pip install mlxtend
```

    Collecting mlxtend
      Downloading https://files.pythonhosted.org/packages/64/e2/1610a86284029abcad0ac9bc86cb19f9787fe6448ede467188b2a5121bb4/mlxtend-0.17.2-py2.py3-none-any.whl (1.3MB)
    Requirement already satisfied: setuptools in d:\software\anaconda\lib\site-packages (from mlxtend) (40.8.0)
    Requirement already satisfied: pandas>=0.24.2 in d:\software\anaconda\lib\site-packages (from mlxtend) (0.25.1)
    Requirement already satisfied: scipy>=1.2.1 in d:\software\anaconda\lib\site-packages (from mlxtend) (1.2.1)
    Requirement already satisfied: matplotlib>=3.0.0 in d:\software\anaconda\lib\site-packages (from mlxtend) (3.0.3)
    Requirement already satisfied: numpy>=1.16.2 in d:\software\anaconda\lib\site-packages (from mlxtend) (1.16.2)
    Collecting joblib>=0.13.2 (from mlxtend)
      Downloading https://files.pythonhosted.org/packages/28/5c/cf6a2b65a321c4a209efcdf64c2689efae2cb62661f8f6f4bb28547cf1bf/joblib-0.14.1-py2.py3-none-any.whl (294kB)
    Requirement already satisfied: scikit-learn>=0.20.3 in d:\software\anaconda\lib\site-packages (from mlxtend) (0.20.3)
    Requirement already satisfied: pytz>=2017.2 in d:\software\anaconda\lib\site-packages (from pandas>=0.24.2->mlxtend) (2018.9)
    Requirement already satisfied: python-dateutil>=2.6.1 in d:\software\anaconda\lib\site-packages (from pandas>=0.24.2->mlxtend) (2.8.0)
    Requirement already satisfied: cycler>=0.10 in d:\software\anaconda\lib\site-packages (from matplotlib>=3.0.0->mlxtend) (0.10.0)
    Requirement already satisfied: kiwisolver>=1.0.1 in d:\software\anaconda\lib\site-packages (from matplotlib>=3.0.0->mlxtend) (1.0.1)
    Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,>=2.0.1 in d:\software\anaconda\lib\site-packages (from matplotlib>=3.0.0->mlxtend) (2.3.1)
    Requirement already satisfied: six>=1.5 in d:\software\anaconda\lib\site-packages (from python-dateutil>=2.6.1->pandas>=0.24.2->mlxtend) (1.12.0)
    Installing collected packages: joblib, mlxtend
    Successfully installed joblib-0.14.1 mlxtend-0.17.2
    


```python
x
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SaleID</th>
      <th>name</th>
      <th>power</th>
      <th>kilometer</th>
      <th>seller</th>
      <th>offerType</th>
      <th>v_0</th>
      <th>v_1</th>
      <th>v_2</th>
      <th>v_3</th>
      <th>...</th>
      <th>power_bin_0.6896551724137931</th>
      <th>power_bin_0.7241379310344828</th>
      <th>power_bin_0.7586206896551724</th>
      <th>power_bin_0.7931034482758621</th>
      <th>power_bin_0.8275862068965517</th>
      <th>power_bin_0.8620689655172413</th>
      <th>power_bin_0.896551724137931</th>
      <th>power_bin_0.9310344827586207</th>
      <th>power_bin_0.9655172413793104</th>
      <th>power_bin_1.0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1</td>
      <td>2262</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>45.305273</td>
      <td>5.236112</td>
      <td>0.137925</td>
      <td>1.380657</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>1</td>
      <td>5</td>
      <td>137642</td>
      <td>0.474626</td>
      <td>0.655172</td>
      <td>0</td>
      <td>0</td>
      <td>46.323165</td>
      <td>-3.229285</td>
      <td>0.156615</td>
      <td>-1.727217</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>2</td>
      <td>7</td>
      <td>165346</td>
      <td>0.467002</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>42.255586</td>
      <td>-3.167771</td>
      <td>-0.676693</td>
      <td>1.942673</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>10</td>
      <td>18961</td>
      <td>0.467002</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>45.401241</td>
      <td>4.195311</td>
      <td>-0.370513</td>
      <td>0.444251</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>4</td>
      <td>13</td>
      <td>8129</td>
      <td>0.506615</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>46.844574</td>
      <td>4.175332</td>
      <td>0.490609</td>
      <td>0.085718</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>112975</td>
      <td>199995</td>
      <td>20903</td>
      <td>0.480856</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>45.621391</td>
      <td>5.958453</td>
      <td>-0.918571</td>
      <td>0.774826</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>112976</td>
      <td>199996</td>
      <td>708</td>
      <td>0.437292</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>43.935162</td>
      <td>4.476841</td>
      <td>-0.841710</td>
      <td>1.328253</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>112977</td>
      <td>199997</td>
      <td>6693</td>
      <td>0.546885</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>46.537137</td>
      <td>4.170806</td>
      <td>0.388595</td>
      <td>-0.704689</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>112978</td>
      <td>199998</td>
      <td>96900</td>
      <td>0.587076</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>46.771359</td>
      <td>-3.296814</td>
      <td>0.243566</td>
      <td>-1.277411</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>112979</td>
      <td>199999</td>
      <td>193384</td>
      <td>0.427535</td>
      <td>0.586207</td>
      <td>0</td>
      <td>0</td>
      <td>43.731010</td>
      <td>-3.121867</td>
      <td>0.027348</td>
      <td>-0.808914</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>112980 rows Ã— 368 columns</p>
</div>




```python
from mlxtend.feature_selection import SequentialFeatureSelector as SFS
from sklearn.linear_model import LinearRegression
sfs = SFS(LinearRegression(),
           k_features=10,
           forward=True,
           floating=False,
           scoring = 'r2',
           cv = 0)
x = data.drop(['price'], axis=1)
x = x.fillna(0)
y = data['price']
x.dropna(axis=0, how='any', inplace=True)
y.dropna(axis=0, how='any', inplace=True)
sfs.fit(x, y)
sfs.k_feature_names_ 
```

ç”»å‡ºæ¥ï¼Œå¯ä»¥çœ‹åˆ°è¾¹é™…æ•ˆç›Š


```python
from mlxtend.plotting import plot_sequential_feature_selection as plot_sfs
import matplotlib.pyplot as plt
fig1 = plot_sfs(sfs.get_metric_dict(), kind='std_dev')
plt.grid()
plt.show()
```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200402005051474.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0V4Y2FsaWJ1clVsaW1pdGVk,size_16,color_FFFFFF,t_70#pic_center)
### 5ï¸âƒ£.3ï¸âƒ£ åµŒå…¥å¼ï¼ˆembeddingï¼‰
Lasso å›å½’å’Œå†³ç­–æ ‘å¯ä»¥å®ŒæˆåµŒå…¥å¼ç‰¹å¾é€‰æ‹©ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯ç”¨åµŒå…¥å¼åšç‰¹å¾ç­›é€‰ã€‚

ä¸‹ä¸€æ­¥å°±æ˜¯å»ºæ¨¡äº†ã€‚ğŸ¤”

